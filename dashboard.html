<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù‡Ø§Ù… | DZ-TRAFFIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-50">
    <nav class="bg-white p-4 shadow flex justify-between items-center">
        <div class="font-bold text-blue-600">DZ-TRAFFIC</div>
        <div>Ø±ØµÙŠØ¯Ùƒ: <span id="userPoints" class="font-bold">0</span> ðŸª™</div>
    </nav>

    <div class="max-w-4xl mx-auto p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
            <a href="withdraw.html" class="bg-green-600 text-white px-4 py-2 rounded">Ø³Ø­Ø¨ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ðŸ’¸</a>
        </div>
        <div id="adsContainer" class="grid gap-4"></div>
    </div>

    <script>
        const supabaseClient = supabase.createClient('https://nbioqaxgjzpyrbcwdkds.supabase.co', 'Ø¶Ø¹_Ù…ÙØªØ§Ø­_ANON_Ù‡Ù†Ø§');

        async function init() {
            const { data: { user } } = await supabaseClient.auth.getUser();
            if (!user) { window.location.href = "index.html"; return; }
            
            const { data: profile } = await supabaseClient.from('profiles').select('points').eq('id', user.id).single();
            document.getElementById('userPoints').innerText = profile?.points || 0;

            const { data: ads } = await supabaseClient.from('ads').select('*');
            const container = document.getElementById('adsContainer');
            ads.forEach(ad => {
                container.innerHTML += `
                    <div class="bg-white p-4 rounded shadow flex justify-between items-center border-r-4 border-blue-500">
                        <div><h3 class="font-bold">${ad.title}</h3><p class="text-sm">Ø§Ù„ÙˆÙ‚Øª: ${ad.required_time} Ø«Ø§Ù†ÙŠØ©</p></div>
                        <button onclick="startTask('${ad.url}', ${ad.reward_points}, ${ad.required_time})" class="bg-blue-600 text-white px-4 py-2 rounded">Ø§Ø±Ø¨Ø­ ${ad.reward_points}</button>
                    </div>`;
            });
        }

        function startTask(url, points, time) {
            alert(`Ø§Ø¨Ù‚ÙŽ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ù„Ù…Ø¯Ø© ${time} Ø«Ø§Ù†ÙŠØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·`);
            window.open(url, '_blank');
            setTimeout(async () => {
                const { data: { user } } = await supabaseClient.auth.getUser();
                await supabaseClient.rpc('increment_points', { user_id: user.id, amount: points });
                alert("Ù…Ø¨Ø±ÙˆÙƒ! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·.");
                location.reload();
            }, time * 1000);
        }
        init();
    </script>
</body>
</html>
