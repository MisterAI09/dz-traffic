<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ | DZ-TRAFFIC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 border-r-8 border-red-600 pr-4">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± ğŸ•¹ï¸</h1>

        <div class="bg-white p-6 rounded-xl shadow-md mb-10">
            <h2 class="text-xl font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ø¥Ø¹Ù„Ø§Ù†)</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <input type="text" id="adTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" class="p-2 border rounded">
                <input type="url" id="adUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹" class="p-2 border rounded">
                <input type="number" id="adPoints" placeholder="Ø§Ù„Ù†Ù‚Ø§Ø·" class="p-2 border rounded">
                <input type="number" id="adTime" placeholder="Ø§Ù„ÙˆÙ‚Øª (Ø«Ø§Ù†ÙŠØ©)" class="p-2 border rounded">
            </div>
            <button onclick="addNewAd()" class="mt-4 bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">Ù†Ø´Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙÙˆØ±Ø§Ù‹</button>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md">
            <h2 class="text-xl font-bold mb-4">Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© ğŸ’°</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-right border-collapse">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="p-3">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th class="p-3">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                            <th class="p-3">Ø§Ù„ÙˆØ³ÙŠÙ„Ø©</th>
                            <th class="p-3">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th class="p-3">Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="withdrawalsTable">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = "https://nbioqaxgjzpyrbcwdkds.supabase.co"; 
        const SUPABASE_KEY = "Ø¶Ø¹Ù‡_Ù‡Ù†Ø§_Ù…Ù†_Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª_API_Keys"; 
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¤ÙˆÙ„
        async function checkAdmin() {
            const { data: { user } } = await _supabase.auth.getUser();
            if (!user) window.location.href = "index.html";
            
            const { data: profile } = await _supabase.from('profiles').select('is_admin').eq('id', user.id).single();
            if (!profile?.is_admin) {
                alert("ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ù„Ùƒ Ø¨Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù‡Ù†Ø§!");
                window.location.href = "dashboard.html";
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯
        async function addNewAd() {
            const title = document.getElementById('adTitle').value;
            const url = document.getElementById('adUrl').value;
            const points = document.getElementById('adPoints').value;
            const time = document.getElementById('adTime').value;

            const { error } = await _supabase.from('ads').insert([{ title, url, reward_points: points, required_time: time }]);
            if (!error) {
                alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!");
                location.reload();
            }
        }

        // Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
        async function loadWithdrawals() {
            const { data: list } = await _supabase.from('withdrawals').select('*').order('created_at', { ascending: false });
            const table = document.getElementById('withdrawalsTable');
            table.innerHTML = list.map(req => `
                <tr class="border-b">
                    <td class="p-3 font-mono">${req.phone_number}</td>
                    <td class="p-3 text-green-600 font-bold">${req.amount_points}</td>
                    <td class="p-3">${req.payment_method}</td>
                    <td class="p-3"><span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">${req.status}</span></td>
                    <td class="p-3">
                        <button onclick="completeWithdraw(${req.id})" class="text-blue-600 hover:underline">ØªÙ… Ø§Ù„Ø¯ÙØ¹ âœ…</button>
                    </td>
                </tr>
            `).join('');
        }

        async function completeWithdraw(id) {
            await _supabase.from('withdrawals').update({ status: 'completed' }).eq('id', id);
            loadWithdrawals();
        }

        checkAdmin();
        loadWithdrawals();
    </script>
</body>
</html>
